<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LOT FOR SALE TRACKER</title>
<style>
  body { font-family: Arial, sans-serif; margin:12px; background: linear-gradient(to right,#e0f7fa,#f1f8e9); }
  h2 { text-align:center; color:#2e7d32; }
  .box { background:#fff; padding:14px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.08); margin:12px auto; max-width:980px; }
  input, button { padding:10px; margin:6px 0; border-radius:6px; border:1px solid #ccc; width:100%; box-sizing:border-box; }
  .row { display:flex; gap:8px; flex-wrap:wrap; }
  .row input, .row button { flex:1; }
  .row button { border:none; cursor:pointer; border-radius:6px; }
  button.primary { background:#2e7d32; color:white; }
  button.warn { background:#d84315; color:white; }
  button.orange { background:#f57f17; color:white; }
  button.small-btn { padding:6px 8px; font-size:12px; width:auto; }
  button:hover { opacity:0.85; }
  .record-card { background:#f9f9f9; padding:12px; border-radius:6px; margin-bottom:12px; border:1px solid #ccc; }
  .small { font-size:13px; color:#555; }
  #trackerForm { margin-top:12px; display:none; transition: box-shadow .2s ease; border-radius:8px; padding:10px; }
  .flash { animation: flash 900ms ease; }
  @keyframes flash { 0% { box-shadow: 0 0 0 0 rgba(46,125,50,0.6); } 40% { box-shadow: 0 0 12px 6px rgba(46,125,50,0.20); } 100% { box-shadow: 0 0 0 0 rgba(46,125,50,0); } }
  .actions { display:flex; gap:6px; align-items:center; flex-wrap:wrap; }
  @media(max-width:768px){
    .row { flex-direction:column; }
    input, button { font-size:16px; }
    .record-card { font-size:15px; }
    .actions { display:flex; gap:6px; }
    .actions button { flex:1; font-size:13px; padding:8px; }
  }
  .dev { text-align: center; font-size: 11px; color: #555; margin-bottom: 14px; font-style: italic; }
</style>
</head>
<body>

<h2>üìÇ LOT FOR SALE TRACKER</h2>
<div class="dev">&copy; 2025 ‚Äî Developed by <b>ROMULO J. JACINTO JR</b></div>

<div id="appBox" class="box">

  <!-- Toggle Button -->
  <button id="toggleFormBtn" class="primary" style="margin-bottom:10px;">‚ûï Add Record</button>

  <!-- FORM -->
  <form id="trackerForm">
    <input type="hidden" id="editIndex">
    <div class="row">
      <input id="ownerName" placeholder="Name of Owner" required>
      <input id="agentName" placeholder="Name of Agent" required>
    </div>
    <div class="row">
      <input id="sqm" placeholder="SQM" required>
      <input id="lotDesc" placeholder="Lot Description">
    </div>
    <div class="row">
      <input id="lotPrice" placeholder="Lot Price">
      <input id="lotAddress" placeholder="Lot Address">
    </div>
    <div class="row">
      <input id="commission" placeholder="Commission">
      <input id="cellphone" placeholder="Cellphone Number">
    </div>
    <div class="row">
      <input id="messenger" placeholder="Messenger">
      <input id="remarks" placeholder="Remarks">
    </div>
    <div class="row">
      <input type="file" id="lotImages" accept="image/*" multiple>
      <small>Select up to 3 images</small>
    </div>
    <div style="margin-top:8px;">
      <button class="primary" type="submit">üíæ Save Record</button>
    </div>
  </form>

  <!-- FILTER -->
  <div style="margin-top:8px" class="small">
    <label>üîé Search</label>
    <input id="searchBox" placeholder="Search lot details...">
  </div>

  <!-- ACTIVE RECORDS -->
  <h4 style="margin-top:12px">üìã Active Records</h4>
  <div id="activeList"></div>

  <!-- ARCHIVED RECORDS -->
  <h4 style="margin-top:12px">üóÑ Archived Records</h4>
  <div id="archivedList"></div>
</div>

<script>
let records = [], archived = [];

/* --- Save & Load --- */
function saveAll(){ 
  localStorage.setItem('records',JSON.stringify(records));
  localStorage.setItem('archived',JSON.stringify(archived));
}
function loadAll(){
  records = JSON.parse(localStorage.getItem('records')||'[]');
  archived = JSON.parse(localStorage.getItem('archived')||'[]');
}

/* --- Render Active --- */
function renderActive(arr){
  const activeList=document.getElementById('activeList');
  activeList.innerHTML='';
  arr.forEach((r)=>{
    const realIndex = records.indexOf(r); 
    const div=document.createElement('div'); div.className='record-card';
    div.innerHTML=`
      <p><b>Name of Owner:</b> ${r.ownerName||''}</p>
      <p><b>Name of Agent:</b> ${r.agentName||''}</p>
      <p><b>SQM:</b> ${r.sqm||''}</p>
      <p><b>Lot Description:</b> ${r.lotDesc||''}</p>
      <p><b>Lot Price:</b> ${r.lotPrice||''}</p>
      <p><b>Lot Address:</b> ${r.lotAddress||''}</p>
      <p><b>Commission:</b> ${r.commission||''}</p>
      <p><b>Cellphone:</b> ${r.cellphone||''}</p>
      <p><b>Messenger:</b> ${r.messenger||''}</p>
      <p><b>Remarks:</b> ${r.remarks||''}</p>
      <div class="actions">
        <button class="primary small-btn" onclick="editRecord(${realIndex})" aria-label="Edit">‚úèÔ∏è</button>
        <button class="warn small-btn" onclick="deleteRecord(${realIndex})" aria-label="Delete">üóëÔ∏è</button>
        <button class="orange small-btn" onclick="archiveRecord(${realIndex})" aria-label="Archive">üì¶</button>
        <button class="small-btn" onclick="copyRecord(${realIndex})" aria-label="Copy">üìã</button>
        <button class="small-btn" onclick="previewPictures(${realIndex})" aria-label="Preview">üëÅÔ∏è</button>
      </div>`;
    activeList.appendChild(div);
  });
}

/* --- Render Archived --- */
function renderArchived(arr){
  const archivedList=document.getElementById('archivedList');
  archivedList.innerHTML='';
  arr.forEach((r,i)=>{
    const div=document.createElement('div'); div.className='record-card';
    div.innerHTML=`
      <p><b>Name of Owner:</b> ${r.ownerName||''}</p>
      <p><b>Name of Agent:</b> ${r.agentName||''}</p>
      <p><b>SQM:</b> ${r.sqm||''}</p>
      <p><b>Lot Description:</b> ${r.lotDesc||''}</p>
      <p><b>Lot Price:</b> ${r.lotPrice||''}</p>
      <p><b>Lot Address:</b> ${r.lotAddress||''}</p>
      <p><b>Commission:</b> ${r.commission||''}</p>
      <p><b>Cellphone:</b> ${r.cellphone||''}</p>
      <p><b>Messenger:</b> ${r.messenger||''}</p>
      <p><b>Remarks:</b> ${r.remarks||''}</p>
      <div class="actions">
        <button class="primary small-btn" onclick="restoreRecord(${i})">‚Ü©Ô∏è</button>
        <button class="warn small-btn" onclick="deleteArchived(${i})">üóëÔ∏è</button>
      </div>`;
    archivedList.appendChild(div);
  });
}
function renderAll(){ renderActive(records); renderArchived(archived); }

/* --- Form Save --- */
document.getElementById('trackerForm').addEventListener('submit',function(e){
  e.preventDefault();
  const fileInput = document.getElementById('lotImages');
  const rec = {
    ownerName: document.getElementById('ownerName').value,
    agentName: document.getElementById('agentName').value,
    sqm: document.getElementById('sqm').value,
    lotDesc: document.getElementById('lotDesc').value,
    lotPrice: document.getElementById('lotPrice').value,
    lotAddress: document.getElementById('lotAddress').value,
    commission: document.getElementById('commission').value,
    cellphone: document.getElementById('cellphone').value,
    messenger: document.getElementById('messenger').value,
    remarks: document.getElementById('remarks').value,
    images: []
  };

  if(fileInput.files.length){
    const files = Array.from(fileInput.files).slice(0,3);
    let loaded = 0;
    files.forEach(file => {
      const reader = new FileReader();
      reader.onload = function(e){
        rec.images.push(e.target.result);
        loaded++;
        if(loaded === files.length){
          saveOrUpdateRecord(rec);
        }
      }
      reader.readAsDataURL(file);
    });
  } else {
    saveOrUpdateRecord(rec);
  }
});

function saveOrUpdateRecord(rec){
  const idx = document.getElementById('editIndex').value;
  if(idx===''){
    records.push(rec);
  } else {
    records[idx] = rec;
    document.getElementById('editIndex').value='';
  }
  saveAll();
  renderAll();
  document.getElementById('trackerForm').reset();
  document.getElementById('trackerForm').style.display='none';
  document.getElementById('toggleFormBtn').textContent='‚ûï Add Record';
}

/* --- Edit/Delete/Archive/Restore --- */
function editRecord(i){ 
  const r=records[i];
  if(!r) return alert('Record not found');

  document.getElementById('ownerName').value=r.ownerName;
  document.getElementById('agentName').value=r.agentName;
  document.getElementById('sqm').value=r.sqm;
  document.getElementById('lotDesc').value=r.lotDesc;
  document.getElementById('lotPrice').value=r.lotPrice;
  document.getElementById('lotAddress').value=r.lotAddress;
  document.getElementById('commission').value=r.commission;
  document.getElementById('cellphone').value=r.cellphone;
  document.getElementById('messenger').value=r.messenger;
  document.getElementById('remarks').value=r.remarks;
  document.getElementById('editIndex').value=i;

  const form = document.getElementById('trackerForm');
  form.style.display='block';
  document.getElementById('toggleFormBtn').textContent='‚ûñ Hide Form';

  form.scrollIntoView({ behavior: 'smooth', block: 'center' });
  setTimeout(()=> {
    document.getElementById('ownerName').focus();
    form.classList.remove('flash');
    void form.offsetWidth;
    form.classList.add('flash');
  }, 120);
}
function deleteRecord(i){ if(confirm('Delete this record?')){ records.splice(i,1); saveAll(); renderAll(); } }
function archiveRecord(i){ const rec=records.splice(i,1)[0]; archived.push(rec); saveAll(); renderAll(); }
function restoreRecord(i){ const rec=archived.splice(i,1)[0]; records.push(rec); saveAll(); renderAll(); }
function deleteArchived(i){ if(confirm('Delete archived record?')){ archived.splice(i,1); saveAll(); renderAll(); } }

/* --- Copy Record --- */
function copyRecord(i){
  const r=records[i];
  if(!r) return alert("Record not found");
  const text=`SQM: ${r.sqm}
Lot Description: ${r.lotDesc}
Lot Price: ${r.lotPrice}
Lot Address: ${r.lotAddress}
Remarks: ${r.remarks}`;
  navigator.clipboard.writeText(text).then(()=>alert('Copied to clipboard'));
}

/* --- Preview Multiple Pictures with Share --- */
function previewPictures(i){
  const r = records[i];
  if(!r || !r.images || r.images.length===0) return alert('No pictures available');
  
  const win = window.open('', '_blank', 'width=500,height=600,scrollbars=yes');
  win.document.write('<h3>Preview Images</h3>');
  r.images.forEach(img => {
    win.document.write(`<img src="${img}" style="width:100%; margin-bottom:10px;">`);
  });
  win.document.write(`<button onclick="shareImages()">Share to Messenger</button>`);
  
  win.document.write(`
    <script>
      function shareImages(){
        const urls = ${JSON.stringify(r.images)};
        urls.forEach(url => {
          const messengerUrl = 'https://www.messenger.com/t/?link=' + encodeURIComponent(url);
          window.open(messengerUrl,'_blank');
        });
      }
    <\/script>
  `);
}

/* --- Search Filter --- */
document.getElementById('searchBox').addEventListener('input', function(){
  const term = this.value.toLowerCase();
  const filtered = records.filter(r =>
    (r.ownerName||'').toLowerCase().includes(term) ||
    (r.agentName||'').toLowerCase().includes(term) ||
    (r.sqm||'').toLowerCase().includes(term) ||
    (r.lotDesc||'').toLowerCase().includes(term) ||
    (r.lotPrice||'').toLowerCase().includes(term) ||
    (r.lotAddress||'').toLowerCase().includes(term) ||
    (r.commission||'').toLowerCase().includes(term) ||
    (r.cellphone||'').toLowerCase().includes(term) ||
    (r.messenger||'').toLowerCase().includes(term) ||
    (r.remarks||'').toLowerCase().includes(term)
  );
  renderActive(filtered);
});

/* --- Toggle Form --- */
document.getElementById('toggleFormBtn').addEventListener('click', function(){
  const form=document.getElementById('trackerForm');
  if(form.style.display==='none' || form.style.display===''){
    form.style.display='block';
    this.textContent='‚ûñ Hide Form';
    setTimeout(()=> form.scrollIntoView({behavior:'smooth', block:'center'}), 80);
  } else {
    form.style.display='none';
    this.textContent='‚ûï Add Record';
  }
});

/* --- Bootstrap --- */
loadAll();
renderAll();
document.getElementById('trackerForm').style.display='none';
</script>
</body>
</html>
